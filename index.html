<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>간단한 피하기 게임</title>
    <style>
      :root {
        font-family: "Pretendard", "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color-scheme: light dark;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at top, #353b48, #1e272e);
        color: #f5f6fa;
      }

      main {
        width: min(90vw, 480px);
        padding: 1.5rem;
        background: rgba(0, 0, 0, 0.35);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 16px;
        backdrop-filter: blur(8px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      }

      h1 {
        margin: 0 0 0.75rem;
        font-size: 1.75rem;
        text-align: center;
      }

      .game-wrapper {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .hud {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1rem;
      }

      .hud span {
        font-weight: 600;
      }

      button {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        border: none;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        color: #2f3542;
        background: linear-gradient(135deg, #ffdd59, #ffa502);
        transition: transform 120ms ease, filter 120ms ease;
      }

      button:hover {
        transform: translateY(-1px);
        filter: brightness(1.05);
      }

      button:active {
        transform: translateY(1px);
      }

      .game-area {
        position: relative;
        width: 100%;
        height: 420px;
        border-radius: 12px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.3);
        background: linear-gradient(180deg, rgba(47, 54, 64, 0.9), rgba(10, 10, 12, 0.9));
      }

      .player,
      .obstacle {
        position: absolute;
        border-radius: 6px;
      }

      .player {
        width: 42px;
        height: 42px;
        background: linear-gradient(135deg, #1dd1a1, #10ac84);
        box-shadow: 0 0 12px rgba(16, 172, 132, 0.8);
      }

      .obstacle {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, #ff6b6b, #ee5253);
        box-shadow: 0 0 12px rgba(238, 82, 83, 0.5);
      }

      .instructions {
        font-size: 0.95rem;
        line-height: 1.4;
        color: rgba(255, 255, 255, 0.75);
      }
    </style>
  </head>
  <body>
    <main>
      <h1>번개 피하기</h1>
      <div class="game-wrapper">
        <div class="hud">
          <div>점수: <span id="score">0</span></div>
          <button id="startBtn">게임 시작</button>
        </div>
        <div class="game-area" id="gameArea">
          <div class="player" id="player"></div>
        </div>
        <p class="instructions">
          ← → 키로 플레이어를 움직여 위에서 떨어지는 장애물을 피하세요! 시간이 지날수록
          속도가 빨라지고 점수가 상승합니다. 충돌 시 게임이 끝납니다.
        </p>
      </div>
    </main>

    <script>
      const area = document.getElementById("gameArea");
      const player = document.getElementById("player");
      const scoreEl = document.getElementById("score");
      const startBtn = document.getElementById("startBtn");

      const areaRect = () => area.getBoundingClientRect();
      const state = {
        playing: false,
        playerX: 0,
        speed: 2.2,
        spawnInterval: null,
        loopId: null,
        score: 0,
      };

      const obstacles = new Set();
      const keys = {
        ArrowLeft: false,
        ArrowRight: false,
      };

      function resetPlayer() {
        const rect = areaRect();
        state.playerX = rect.width / 2 - player.offsetWidth / 2;
        player.style.bottom = "12px";
        player.style.left = `${state.playerX}px`;
      }

      function spawnObstacle() {
        const rect = areaRect();
        const obstacle = document.createElement("div");
        obstacle.className = "obstacle";
        const x = Math.random() * (rect.width - 40);
        obstacle.style.left = `${x}px`;
        obstacle.style.top = "-40px";
        area.appendChild(obstacle);
        obstacles.add({
          el: obstacle,
          y: -40,
        });
      }

      function updateObstacles(delta) {
        const rect = areaRect();
        obstacles.forEach((obj) => {
          obj.y += state.speed * delta;
          obj.el.style.top = `${obj.y}px`;

          if (isColliding(obj.el, player)) {
            endGame();
          }

          if (obj.y > rect.height + 40) {
            obj.el.remove();
            obstacles.delete(obj);
            state.score += 1;
            scoreEl.textContent = state.score;
            state.speed = 2.2 + state.score * 0.08;
          }
        });
      }

      function isColliding(a, b) {
        const ar = a.getBoundingClientRect();
        const br = b.getBoundingClientRect();
        return !(
          ar.bottom < br.top ||
          ar.top > br.bottom ||
          ar.right < br.left ||
          ar.left > br.right
        );
      }

      function movePlayer(delta) {
        const rect = areaRect();
        const moveSpeed = 0.35 * state.speed * delta;
        if (keys.ArrowLeft) {
          state.playerX = Math.max(0, state.playerX - moveSpeed);
        }
        if (keys.ArrowRight) {
          state.playerX = Math.min(
            rect.width - player.offsetWidth,
            state.playerX + moveSpeed
          );
        }
        player.style.left = `${state.playerX}px`;
      }

      let lastTime = 0;
      function gameLoop(timestamp) {
        if (!state.playing) return;
        const delta = Math.min(16, timestamp - lastTime);
        lastTime = timestamp;
        movePlayer(delta);
        updateObstacles(delta);
        state.loopId = requestAnimationFrame(gameLoop);
      }

      function clearObstacles() {
        obstacles.forEach((obj) => obj.el.remove());
        obstacles.clear();
      }

      function startGame() {
        if (state.playing) return;
        state.playing = true;
        state.score = 0;
        state.speed = 2.2;
        scoreEl.textContent = "0";
        lastTime = performance.now();
        clearObstacles();
        resetPlayer();
        state.spawnInterval = setInterval(spawnObstacle, 900);
        state.loopId = requestAnimationFrame(gameLoop);
        startBtn.textContent = "게임 중";
        startBtn.disabled = true;
      }

      function endGame() {
        state.playing = false;
        clearInterval(state.spawnInterval);
        cancelAnimationFrame(state.loopId);
        startBtn.textContent = "다시 시작";
        startBtn.disabled = false;
        alert(`게임 종료! 최종 점수: ${state.score}`);
      }

      startBtn.addEventListener("click", startGame);

      window.addEventListener("keydown", (e) => {
        if (e.code in keys) {
          keys[e.code] = true;
          e.preventDefault();
        }
      });

      window.addEventListener("keyup", (e) => {
        if (e.code in keys) {
          keys[e.code] = false;
          e.preventDefault();
        }
      });

      window.addEventListener("resize", resetPlayer);
      document.addEventListener("visibilitychange", () => {
        if (document.hidden && state.playing) {
          endGame();
        }
      });

      resetPlayer();
    </script>
  </body>
</html>
